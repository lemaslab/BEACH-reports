---
title: "Build BEACH Table 1 Report"
author: "Dominick Lemas, Michele Himadi"
date: "3/01/2023"

---

```{r, include=FALSE}
##-------------- 
# **************************************************************************** #
# ***************                Project Overview              *************** #
# **************************************************************************** #

# Author:            Dominick J. Lemas
# Start Date:        2/07/2023 
# Date Modify:       3/1/2023
# Project:           The Breastfeeding and EArly Child Health
# IRB:               IRB201601034
#                   
#
# version: R version 4.0.2 (2020-06-22)
# version: Rstudio version Version 1.3.959 

# **************************************************************************** #
# ***************                Description                   *************** #
# **************************************************************************** #

# NOTE: This script consumes data that was generated by:
# ~/code/get/get_RedCapData_36804.Rmd
# ~/code/format/format_RedCapData_BEACHTable1.rmd

# PLAN: Complete NIH Enrollment Table.

project_name="The Breastfeeding and EArly Child Health Study"
irb_number="IRB201601034"
upstream_code="~/code/format/format_RedCapData_BEACHTable1.Rmd"
report_id<-36804L
report_name= "BEACH Table 1"
input_file="36804_BEACHTable1_clean.RData"

```


```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #

library(codified)
library(tidyverse)
library(gtsummary)
library(dplyr)

```

```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************         WIP / Build Summary Table            *************** #
# **************************************************************************** #



tb_sum <- table1_formatted %>%
  tbl_summary(by = BMI_Group)

print(tb_sum)

```

```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/processed/36804_BEACHTable1_clean.RData")

#creating table 1 groups based on BMI Group
table1_nw <- table1_formatted[table1_formatted$BMI_Group == "NW", ]
table1_ow <- table1_formatted[table1_formatted$BMI_Group == "OW", ]
table1_ob <- table1_formatted[table1_formatted$BMI_Group == "OB", ]

#creating sample groups based on BMI Group
sample_grouping_nw <- sample_grouping[sample_grouping$BMI_Group == "NW", ]
sample_grouping_ow <- sample_grouping[sample_grouping$BMI_Group == "OW", ]
sample_grouping_ob <- sample_grouping[sample_grouping$BMI_Group == "OB", ]

```


```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************          Calculating Table 1 Stats           *************** #
# **************************************************************************** #
#create table frame with rows to describe maternal age, gestational age, breastfeeding (months)
table1 <- data.frame(Variables = c("n and p values", "Maternal Age", "Gestational Age", "Breastfeeding (months)", "BMI"))
  #will fill in n and p values at the end

#adding means for overall category
table1[2,2] = paste(mean(table1_formatted$Maternal_Age, na.rm = TRUE), "+/-", sd(table1_formatted$Maternal_Age, na.rm = TRUE))
table1[3,2] = paste(mean(table1_formatted$Gestational_Age, na.rm = TRUE), "+/-", sd(table1_formatted$Gestational_Age, na.rm = TRUE))
table1[4,2] = paste(mean(table1_formatted$Breastfeeding_Months, na.rm = TRUE), "+/-", sd(table1_formatted$Breastfeeding_Months, na.rm = TRUE))
table1[5,2] = paste(mean(table1_formatted$BMI, na.rm = TRUE),"+/-",sd(table1_formatted$BMI))

#adding means for normal weight category
table1[2,3] = paste(mean(table1_nw$Maternal_Age, na.rm = TRUE), "+/-", sd(table1_nw$Maternal_Age, na.rm = TRUE))
table1[3,3] = paste(mean(table1_nw$Gestational_Age, na.rm = TRUE), "+/-", sd(table1_nw$Gestational_Age, na.rm = TRUE))
table1[4,3] = paste(mean(table1_nw$Breastfeeding_Months, na.rm = TRUE), "+/-", sd(table1_nw$Breastfeeding_Months, na.rm = TRUE))
table1[5,3] = paste(mean(table1_nw$BMI, na.rm = TRUE), "+/-", sd(table1_nw$BMI))

class(table1_nw$BMI)

#adding means for overweight weight category
table1[2,4] = paste(mean(table1_ow$Maternal_Age, na.rm = TRUE), "+/-", sd(table1_ow$Maternal_Age, na.rm = TRUE))
table1[3,4] = paste(mean(table1_ow$Gestational_Age, na.rm = TRUE), "+/-", sd(table1_ow$Gestational_Age, na.rm = TRUE))
table1[4,4] = paste(mean(table1_ow$Breastfeeding_Months, na.rm = TRUE), "+/-", sd(table1_ow$Breastfeeding_Months, na.rm = TRUE))
table1[5,4] = paste(mean(table1_ow$BMI, na.rm = TRUE), "+/-", sd(table1_ow$BMI, na.rm = TRUE))

#adding means for obese category
table1[2,5] = paste(mean(table1_ob$Maternal_Age, na.rm = TRUE), "+/-", sd(table1_ob$Maternal_Age, na.rm = TRUE))
table1[3,5] = paste(mean(table1_ob$Gestational_Age, na.rm = TRUE), "+/-", sd(table1_ob$Gestational_Age, na.rm = TRUE))
table1[4,5] = paste(mean(table1_ob$Breastfeeding_Months, na.rm = TRUE), "+/-", sd(table1_ob$Breastfeeding_Months, na.rm = TRUE))
table1[5,5] = paste(mean(table1_ob$BMI, na.rm = TRUE), "+/-", sd(table1_ob$BMI))


```


```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************                n and p values                *************** #
# **************************************************************************** #


#add n value and p value for each category: overall, normal weight, overweight, obese
table1[1,2] = (paste("n =",nrow(table1_formatted),"( p =",nrow(table1_formatted)/nrow(table1_formatted)," )"))
table1[1,3] = (paste("n =",nrow(table1_nw),"( p =", round(nrow(table1_nw)/nrow(table1_formatted), digits = 2)," )"))
table1[1,4] = (paste("n =",nrow(table1_ow),"( p =", round(nrow(table1_ow)/nrow(table1_formatted), digits = 2)," )"))
table1[1,5] = (paste("n =",nrow(table1_ob),"( p =", round(nrow(table1_ob)/nrow(table1_formatted), digits = 2)," )"))

#rename table columns to reflect category
colnames(table1)[2] <- "Overall"
colnames(table1)[3] <- "Normal Weight"
colnames(table1)[4] <- "Overweight"
colnames(table1)[5] <- "Obese"

```

```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************              Samples Quantified              *************** #
# **************************************************************************** #

#create table frame with rows to describe maternal age, gestational age, breastfeeding (months)
sample1 <- data.frame(Variables = c("n and p value","Breastmilk", "Maternal Blood", "Maternal Stool", "Infant Blood", "Infant Stool", "Diet Records"))

#adding total for overall category
sample1[2,2] = sum(!is.na(sample_grouping$mompostnat_crc_milk_time))
sample1[3,2] = sum(!is.na(sample_grouping$mom3t_crc_blood_time),!is.na(sample_grouping$mompostnat_crc_blood_time))
sample1[4,2] = sum(!is.na(sample_grouping$mom3t_crc_stool_time),!is.na(sample_grouping$mompostnat_crc_stool_time))
sample1[5,2] = sum(!is.na(sample_grouping$infant_crc_blood_time))
sample1[6,2] = sum(!is.na(sample_grouping$infant_crc_stool_time))
sample1[7,2] = sum(!is.na(sample_grouping$beach_foodrecord_hardcopy))

#adding total for normal weight category
sample1[2,3] = sum(!is.na(sample_grouping_nw$mompostnat_crc_milk_time))
sample1[3,3] = sum(!is.na(sample_grouping_nw$mom3t_crc_blood_time),!is.na(sample_grouping_nw$mompostnat_crc_blood_time))
sample1[4,3] = sum(!is.na(sample_grouping_nw$mom3t_crc_stool_time),!is.na(sample_grouping_nw$mompostnat_crc_stool_time))
sample1[5,3] = sum(!is.na(sample_grouping_nw$infant_crc_blood_time))
sample1[6,3] = sum(!is.na(sample_grouping_nw$infant_crc_stool_time))
sample1[7,3] = sum(!is.na(sample_grouping_nw$beach_foodrecord_hardcopy))

#adding total for overweight category
sample1[2,4] = sum(!is.na(sample_grouping_ow$mompostnat_crc_milk_time))
sample1[3,4] = sum(!is.na(sample_grouping_ow$mom3t_crc_blood_time),!is.na(sample_grouping_ow$mompostnat_crc_blood_time))
sample1[4,4] = sum(!is.na(sample_grouping_ow$mom3t_crc_stool_time),!is.na(sample_grouping_ow$mompostnat_crc_stool_time))
sample1[5,4] = sum(!is.na(sample_grouping_ow$infant_crc_blood_time))
sample1[6,4] = sum(!is.na(sample_grouping_ow$infant_crc_stool_time))
sample1[7,4] = sum(!is.na(sample_grouping_ow$beach_foodrecord_hardcopy))

#adding total for obese category
sample1[2,5] = sum(!is.na(sample_grouping_ob$mompostnat_crc_milk_time))
sample1[3,5] = sum(!is.na(sample_grouping_ob$mom3t_crc_blood_time),!is.na(sample_grouping_ob$mompostnat_crc_blood_time))
sample1[4,5] = sum(!is.na(sample_grouping_ob$mom3t_crc_stool_time),!is.na(sample_grouping_ob$mompostnat_crc_stool_time))
sample1[5,5] = sum(!is.na(sample_grouping_ob$infant_crc_blood_time))
sample1[6,5] = sum(!is.na(sample_grouping_ob$infant_crc_stool_time))
sample1[7,5] = sum(!is.na(sample_grouping_ob$beach_foodrecord_hardcopy))

```

```{r, message=FALSE,include=FALSE}

# **************************************************************************** #
# ***************                n and p values                *************** #
# **************************************************************************** #

#remove 

#add n value and p value for each category: overall, normal weight, overweight, obese
sample1[1,2] = (paste("n =",nrow(sample_grouping),"( p =",nrow(sample_grouping)/nrow(sample_grouping)," )"))
sample1[1,3] = (paste("n =",nrow(sample_grouping_nw),"( p =", round(nrow(sample_grouping_nw)/nrow(sample_grouping), digits = 2)," )"))
sample1[1,4] = (paste("n =",nrow(sample_grouping_ow),"( p =", round(nrow(sample_grouping_ow)/nrow(sample_grouping), digits = 2)," )"))
sample1[1,5] = (paste("n =",nrow(sample_grouping_ob),"( p =", round(nrow(sample_grouping_ob)/nrow(sample_grouping), digits = 2)," )"))

#rename table columns to reflect category
colnames(sample1)[2] <- "Overall"
colnames(sample1)[3] <- "Normal Weight"
colnames(sample1)[4] <- "Overweight"
colnames(sample1)[5] <- "Obese"

```


