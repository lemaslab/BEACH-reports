git reset commit-id
git status
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
library(keyringr)
library(redcapAPI)
library(REDCapR)
library(tidyverse)
# library(ezknitr)
source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Extract Data                    *************** #
# **************************************************************************** #
# API & URL
#----------
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
api_token=get_API_token("beach_api")
# REPORT IDS
#-----------
# Study Overview
report_id<-21221L
report_name= "BEACH Study Overview"
# PULL DATA
#-----------
report_raw <-
REDCapR::redcap_report(
redcap_uri = uri,
token      = api_token,
report_id  = report_id
)$data
report = report_raw %>%
select(-redcap_event_name,-redcap_repeat_instrument,-redcap_repeat_instance,    # drop out variables not needed
-clinical_health_update_2wk_v4_042218_complete,
-health_update_3rd_trimester_v5082518_complete,-biosample_notes,
-infant_postnatal_care_other,-mom_healthcare_other,
-exitsurvey_resultsinfo)
View(report)
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/raw/report_21221.RData")
enroll = report %>% select(test_id, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1, maternal_race_nih___2,
maternal_race_nih___3,
maternal_race_nih___4, maternal_race_nih___5,
maternal_race_nih___6,
infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1, infant_race_nih___2, infant_race_nih___3,
infant_race_nih___4, infant_race_nih___5, infant_race_nih___6)
# create long dataset where each row is a unique mom or infant. The number of
# rows will represent the total number of mom-baby participants that have signed
# ICF and we have collected data on the infant.
maternal=enroll %>%
mutate(participant_type="maternal") %>%
select(test_id, participant_type, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1,
maternal_race_nih___2, maternal_race_nih___3, maternal_race_nih___4,
maternal_race_nih___5, maternal_race_nih___6) %>%
rename(sex_nih=maternal_sex_nih,
ethnicity_nih=mom_ethnicity_nih,
race_nih___1=maternal_race_nih___1,
race_nih___2=maternal_race_nih___2,
race_nih___3=maternal_race_nih___3,
race_nih___4=maternal_race_nih___4,
race_nih___5=maternal_race_nih___5,
race_nih___6=maternal_race_nih___6)
infant= enroll %>%
mutate(participant_type="infant") %>%
select(test_id, participant_type, infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1,
infant_race_nih___2, infant_race_nih___3, infant_race_nih___4,
infant_race_nih___5, infant_race_nih___6) %>%
rename(sex_nih=infant_sex_nih,
ethnicity_nih=infant_ethnicity_nih,
race_nih___1=infant_race_nih___1,
race_nih___2=infant_race_nih___2,
race_nih___3=infant_race_nih___3,
race_nih___4=infant_race_nih___4,
race_nih___5=infant_race_nih___5,
race_nih___6=infant_race_nih___6)
data_all = rbind(maternal,infant)
View(data_all)
# FORMAT DATA
#------------
data = data_all  %>%
gather("race", "value", race_nih___1:race_nih___6) %>%
filter(value==1) %>%
mutate(race=recode_factor(race,
"race_nih___1" = "NativeAmerican",
"race_nih___2" = "Asian",
"race_nih___3" = "Black",
"race_nih___4" = "PacificIsland",
"race_nih___5" = "White",
"race_nih___6" = "NA")) %>%
select(-value)
View(data)
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
library(codified)
library(tidyverse)
# https://cran.r-project.org/web/packages/codified/vignettes/nih-enrollment-html.html
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/processed/21221_NIHenrollment_clean.RData")
#remove participants who have more than one race listed and change their type to "two or more races" ("M")
data$combined = paste(data$test_id, data$participant_type)
data$race=as.character(data$race)
data$race[duplicated(data$combined) | duplicated(data$combined, fromLast = TRUE)] <- "M"
data = data[!duplicated(data$combined),]
ds=data %>%
rename(gender=sex_nih,
ethnicity=ethnicity_nih) %>%
select(gender,ethnicity,race)
ds$gender=as.character(ds$gender)
ds$ethnicity=as.character(ds$ethnicity)
ds$race=as.character(ds$race)
# ds[ds$gender=="<NA>"]=NA
# **************************************************************************** #
# ***************              Data Labels                     *************** #
# **************************************************************************** #
# gender
ds_lu_gender <- tibble::tribble(
~input,   ~displayed            ,
"1"   ,  "Male"               ,
"2"   ,  "Female"                 ,
"3"   ,  "Unknown/Not Reported"
)
# knitr::kable(ds_lu_gender, caption = "Gender Mapping")
# race
ds_lu_race <- tibble::tribble(
~input , ~displayed                                   ,
"NativeAmerican"    , "American Indian or Alaska Native"              ,
"Asian"             , "Asian",
"PacificIsland"    , "Native Hawaiian or Other Pacific Islander"  ,
"Black"    , "Black or African American"                  ,
"White"    , "White"                                      ,
"M"    , "More than One Race"                         ,
"NA"    , "Unknown or Not Reported"
)
# knitr::kable(ds_lu_race, caption = "Race Mapping")
# ethnicity
ds_lu_ethnicity <- tibble::tribble(
~input,   ~displayed                      ,
"1"   ,  "Not Hispanic or Latino"         ,
"2"   ,  "Hispanic or Latino"             ,
"3"   ,  "Unknown/Not Reported Ethnicity"
)
# knitr::kable(ds_lu_ethnicity, caption = "Ethnicity Mapping")
# **************************************************************************** #
# ***************         NIH enrollment table                 *************** #
# **************************************************************************** #
ds_summary_long <- codified::table_nih_enrollment(
d              = ds,
d_lu_gender    = ds_lu_gender,
d_lu_race      = ds_lu_race,
d_lu_ethnicity = ds_lu_ethnicity
)
knitr::kable(ds_summary_long, caption = "Counts of Each Subgroup")
codified::table_nih_enrollment_pretty(
d              = ds,
d_lu_gender    = ds_lu_gender,
d_lu_race      = ds_lu_race,
d_lu_ethnicity = ds_lu_ethnicity
)
View(maternal)
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
library(keyringr)
library(redcapAPI)
library(REDCapR)
library(tidyverse)
# library(ezknitr)
source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Extract Data                    *************** #
# **************************************************************************** #
# API & URL
#----------
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
api_token=get_API_token("beach_api")
# REPORT IDS
#-----------
# Study Overview
report_id<-21221L
report_name= "BEACH Study Overview"
# PULL DATA
#-----------
report_raw <-
REDCapR::redcap_report(
redcap_uri = uri,
token      = api_token,
report_id  = report_id
)$data
report = report_raw %>%
select(-redcap_event_name,-redcap_repeat_instrument,-redcap_repeat_instance,    # drop out variables not needed
-clinical_health_update_2wk_v4_042218_complete,
-health_update_3rd_trimester_v5082518_complete,-biosample_notes,
-infant_postnatal_care_other,-mom_healthcare_other,
-exitsurvey_resultsinfo)
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
#library(readxl)
library(tidyverse)
# source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/raw/report_21221.RData")
enroll = report %>% select(test_id, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1, maternal_race_nih___2,
maternal_race_nih___3,
maternal_race_nih___4, maternal_race_nih___5,
maternal_race_nih___6,
infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1, infant_race_nih___2, infant_race_nih___3,
infant_race_nih___4, infant_race_nih___5, infant_race_nih___6)
# create long dataset where each row is a unique mom or infant. The number of
# rows will represent the total number of mom-baby participants that have signed
# ICF and we have collected data on the infant.
maternal=enroll %>%
mutate(participant_type="maternal") %>%
select(test_id, participant_type, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1,
maternal_race_nih___2, maternal_race_nih___3, maternal_race_nih___4,
maternal_race_nih___5, maternal_race_nih___6) %>%
rename(sex_nih=maternal_sex_nih,
ethnicity_nih=mom_ethnicity_nih,
race_nih___1=maternal_race_nih___1,
race_nih___2=maternal_race_nih___2,
race_nih___3=maternal_race_nih___3,
race_nih___4=maternal_race_nih___4,
race_nih___5=maternal_race_nih___5,
race_nih___6=maternal_race_nih___6)
infant= enroll %>%
mutate(participant_type="infant") %>%
select(test_id, participant_type, infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1,
infant_race_nih___2, infant_race_nih___3, infant_race_nih___4,
infant_race_nih___5, infant_race_nih___6) %>%
rename(sex_nih=infant_sex_nih,
ethnicity_nih=infant_ethnicity_nih,
race_nih___1=infant_race_nih___1,
race_nih___2=infant_race_nih___2,
race_nih___3=infant_race_nih___3,
race_nih___4=infant_race_nih___4,
race_nih___5=infant_race_nih___5,
race_nih___6=infant_race_nih___6)
data_all = rbind(maternal,infant)
# FORMAT DATA
#------------
data = data_all  %>%
gather("race", "value", race_nih___1:race_nih___6) %>%
filter(value==1) %>%
mutate(race=recode_factor(race,
"race_nih___1" = "NativeAmerican",
"race_nih___2" = "Asian",
"race_nih___3" = "Black",
"race_nih___4" = "PacificIsland",
"race_nih___5" = "White",
"race_nih___6" = "NA")) %>%
select(-value)
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/processed/21221_NIHenrollment_clean.RData")
#remove participants who have more than one race listed and change their type to "two or more races" ("M")
data$combined = paste(data$test_id, data$participant_type)
data$race=as.character(data$race)
data$race[duplicated(data$combined) | duplicated(data$combined, fromLast = TRUE)] <- "M"
data = data[!duplicated(data$combined),]
ds=data %>%
rename(gender=sex_nih,
ethnicity=ethnicity_nih) %>%
select(gender,ethnicity,race)
ds$gender=as.character(ds$gender)
ds$ethnicity=as.character(ds$ethnicity)
ds$race=as.character(ds$race)
# ds[ds$gender=="<NA>"]=NA
View(data)
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
library(keyringr)
library(redcapAPI)
library(REDCapR)
library(tidyverse)
# library(ezknitr)
source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Extract Data                    *************** #
# **************************************************************************** #
# API & URL
#----------
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
api_token=get_API_token("beach_api")
# REPORT IDS
#-----------
# Study Overview
report_id<-21221L
report_name= "BEACH Study Overview"
# PULL DATA
#-----------
report_raw <-
REDCapR::redcap_report(
redcap_uri = uri,
token      = api_token,
report_id  = report_id
)$data
report = report_raw %>%
select(-redcap_event_name,-redcap_repeat_instrument,-redcap_repeat_instance,    # drop out variables not needed
-clinical_health_update_2wk_v4_042218_complete,
-health_update_3rd_trimester_v5082518_complete,-biosample_notes,
-infant_postnatal_care_other,-mom_healthcare_other,
-exitsurvey_resultsinfo)
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
#library(readxl)
library(tidyverse)
# source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/raw/report_21221.RData")
enroll = report %>% select(test_id, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1, maternal_race_nih___2,
maternal_race_nih___3,
maternal_race_nih___4, maternal_race_nih___5,
maternal_race_nih___6,
infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1, infant_race_nih___2, infant_race_nih___3,
infant_race_nih___4, infant_race_nih___5, infant_race_nih___6)
# create long dataset where each row is a unique mom or infant. The number of
# rows will represent the total number of mom-baby participants that have signed
# ICF and we have collected data on the infant.
maternal=enroll %>%
mutate(participant_type="maternal") %>%
select(test_id, participant_type, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1,
maternal_race_nih___2, maternal_race_nih___3, maternal_race_nih___4,
maternal_race_nih___5, maternal_race_nih___6) %>%
rename(sex_nih=maternal_sex_nih,
ethnicity_nih=mom_ethnicity_nih,
race_nih___1=maternal_race_nih___1,
race_nih___2=maternal_race_nih___2,
race_nih___3=maternal_race_nih___3,
race_nih___4=maternal_race_nih___4,
race_nih___5=maternal_race_nih___5,
race_nih___6=maternal_race_nih___6)
#infant= enroll %>%
#  mutate(participant_type="infant") %>%
#  select(test_id, participant_type, infant_sex_nih, infant_ethnicity_nih,
#         infant_race_nih___1,
#         infant_race_nih___2, infant_race_nih___3, infant_race_nih___4,
#         infant_race_nih___5, infant_race_nih___6) %>%
#  rename(sex_nih=infant_sex_nih,
#         ethnicity_nih=infant_ethnicity_nih,
#         race_nih___1=infant_race_nih___1,
#         race_nih___2=infant_race_nih___2,
#         race_nih___3=infant_race_nih___3,
#         race_nih___4=infant_race_nih___4,
#         race_nih___5=infant_race_nih___5,
#         race_nih___6=infant_race_nih___6)
#data_all = rbind(maternal,infant)
data_all = maternal
# FORMAT DATA
#------------
data = data_all  %>%
gather("race", "value", race_nih___1:race_nih___6) %>%
filter(value==1) %>%
mutate(race=recode_factor(race,
"race_nih___1" = "NativeAmerican",
"race_nih___2" = "Asian",
"race_nih___3" = "Black",
"race_nih___4" = "PacificIsland",
"race_nih___5" = "White",
"race_nih___6" = "NA")) %>%
select(-value)
# **************************************************************************** #
# ***************              Load/Trim Data                  *************** #
# **************************************************************************** #
load("~/BEACH-reports/data/processed/21221_NIHenrollment_clean.RData")
#remove participants who have more than one race listed and change their type to "two or more races" ("M")
data$combined = paste(data$test_id, data$participant_type)
data$race=as.character(data$race)
data$race[duplicated(data$combined) | duplicated(data$combined, fromLast = TRUE)] <- "M"
data = data[!duplicated(data$combined),]
ds=data %>%
rename(gender=sex_nih,
ethnicity=ethnicity_nih) %>%
select(gender,ethnicity,race)
ds$gender=as.character(ds$gender)
ds$ethnicity=as.character(ds$ethnicity)
ds$race=as.character(ds$race)
# ds[ds$gender=="<NA>"]=NA
View(data)
# **************************************************************************** #
# ***************              Extract Data                    *************** #
# **************************************************************************** #
# API & URL
#----------
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
api_token=get_API_token("beach_api")
# **************************************************************************** #
# ***************                Library                       *************** #
# **************************************************************************** #
library(keyringr)
library(redcapAPI)
library(REDCapR)
library(tidyverse)
# library(ezknitr)
source("~/BEACH-reports/code/utils/utils.R")
# **************************************************************************** #
# ***************              Extract Data                    *************** #
# **************************************************************************** #
# API & URL
#----------
uri <- "https://redcap.ctsi.ufl.edu/redcap/api/"
api_token=get_API_token("beach_api")
# REPORT IDS
#-----------
# Study Overview
report_id<-21221L
report_name= "BEACH Study Overview"
# PULL DATA
#-----------
report_raw <-
REDCapR::redcap_report(
redcap_uri = uri,
token      = api_token,
report_id  = report_id
)$data
report = report_raw %>%
select(-redcap_event_name,-redcap_repeat_instrument,-redcap_repeat_instance,    # drop out variables not needed
-clinical_health_update_2wk_v4_042218_complete,
-health_update_3rd_trimester_v5082518_complete,-biosample_notes,
-infant_postnatal_care_other,-mom_healthcare_other,
-exitsurvey_resultsinfo)
enroll = report %>% select(test_id, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1, maternal_race_nih___2,
maternal_race_nih___3,
maternal_race_nih___4, maternal_race_nih___5,
maternal_race_nih___6,
infant_sex_nih, infant_ethnicity_nih,
infant_race_nih___1, infant_race_nih___2, infant_race_nih___3,
infant_race_nih___4, infant_race_nih___5, infant_race_nih___6)
maternal=enroll %>%
mutate(participant_type="maternal") %>%
select(test_id, participant_type, maternal_sex_nih, mom_ethnicity_nih,
maternal_race_nih___1,
maternal_race_nih___2, maternal_race_nih___3, maternal_race_nih___4,
maternal_race_nih___5, maternal_race_nih___6) %>%
rename(sex_nih=maternal_sex_nih,
ethnicity_nih=mom_ethnicity_nih,
race_nih___1=maternal_race_nih___1,
race_nih___2=maternal_race_nih___2,
race_nih___3=maternal_race_nih___3,
race_nih___4=maternal_race_nih___4,
race_nih___5=maternal_race_nih___5,
race_nih___6=maternal_race_nih___6)
data_all = maternal
data = data_all  %>%
gather("race", "value", race_nih___1:race_nih___6) %>%
filter(value==1) %>%
mutate(race=recode_factor(race,
"race_nih___1" = "NativeAmerican",
"race_nih___2" = "Asian",
"race_nih___3" = "Black",
"race_nih___4" = "PacificIsland",
"race_nih___5" = "White",
"race_nih___6" = "NA")) %>%
select(-value)
#remove participants who have more than one race listed and change their type to "two or more races" ("M")
data$combined = paste(data$test_id, data$participant_type)
data$race=as.character(data$race)
data$race[duplicated(data$combined) | duplicated(data$combined, fromLast = TRUE)] <- "M"
data = data[!duplicated(data$combined),]
ds=data %>%
rename(gender=sex_nih,
ethnicity=ethnicity_nih) %>%
select(gender,ethnicity,race)
ds$gender=as.character(ds$gender)
ds$ethnicity=as.character(ds$ethnicity)
ds$race=as.character(ds$race)
View(data)
View(ds)
sum(data$race = 'White')
sum(data$race, 'White')
sum(data$race == 'White')
59/83
